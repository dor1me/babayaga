[gd_scene load_steps=3 format=3 uid="uid://dlubojakhnpqs"]

[ext_resource type="Texture2D" uid="uid://3lu5mns1b1p" path="res://enemies/kolobok/kolobok.png" id="1_jwq1d"]

[sub_resource type="GDScript" id="GDScript_vvop3"]
script/source = "extends Node2D

@onready var chat = $chat
@onready var say1 = $Button
@onready var say2 = $Button2

var left_texture



func create_label(str, alignment):
	var label = Label.new()
	var image
	var label_offset_x = 0
	if alignment==HORIZONTAL_ALIGNMENT_LEFT: 
		image = Image.load_from_file(\"res://maps/chat/left.png\")
	else:
		image = Image.load_from_file(\"res://maps/chat/right.png\")
		label_offset_x = 100
		
	label.horizontal_alignment = alignment
	
	
	
	var texture = ImageTexture.create_from_image(image)
	label.add_theme_font_size_override(\"font_size\", 24)
	label.add_theme_color_override(\"font_color\", Color.BLACK)
	chat.add_child(label)
	label.position.x = 60+label_offset_x
	label.autowrap_mode = TextServer.AUTOWRAP_WORD_SMART;
	label.text = str
	
	
	label.size.x = chat.size.x - 240
	label.size.y = label.get_line_height()*label.get_line_count()
	
	var back = NinePatchRect.new();
	back.texture = texture;
	back.patch_margin_bottom = 70
	back.patch_margin_top = 50
	back.patch_margin_left = 50
	back.patch_margin_right = 50
	back.show_behind_parent = true
	
	back.position.x = -60
	back.position.y = -30
	back.size.x = label.size.x+120
	back.size.y = label.size.y+120
	label.add_child(back)
	
	
	# move up
	for child in chat.get_children(false):
		if child == label:
			continue
		child.position.y -= label.size.y + label.get_line_height()+60;

	label.position.y = chat.size.y - label.size.y -120
	
	
	return label

var messages = [\"Здравствуйте, круглый мой дружочек!/rНе запрыгнешь на носочек!?\", \"Ой, Яга, не хохочи!/rЯ не тот уж, не свищи -/rЯ теперь 'клубок учёный',/rА не гриб какой моченый!/rВсё, что хочешь вопрошай -/rИ ответов ожидай\", \"Не видал ли...\", \"Ой, видал!/rМного ль, мало ль... Каравай./rИ кровать, и стул и ложку.../rЯ сварил вчера окрошку!\", \"Ой, касатик, мне б Кощея.../rА не то одна идея...\", \"Эт не знаю, может Ырка!/rВот она то здесь пронырка...\"]

func generate_text():
	var x = 0
	var str = \"\"
	var n = String.num(chat.get_child_count(false));
	for i in randi()%3+1:
		if str.length() !=0:
			str += \"\\r\"
		
	return str
var x = 0
func conversation(x):
	while x < messages.size():
		if x%2==0:
			_on_button_pressed()
			say1.disabled = false
		else: 
			_on_button_2_pressed()
			say2.disabled = false
		x+=1

func _on_button_pressed():
	conversation(0)
	create_label(generate_text(),HORIZONTAL_ALIGNMENT_LEFT)
	


func _on_button_2_pressed():
	conversation(0)
	create_label(generate_text(),HORIZONTAL_ALIGNMENT_RIGHT)
"

[node name="Node2D" type="Node2D"]
script = SubResource("GDScript_vvop3")

[node name="Sprite2D" type="Sprite2D" parent="."]
position = Vector2(422.111, 231.5)
scale = Vector2(0.449074, 0.449074)
texture = ExtResource("1_jwq1d")
